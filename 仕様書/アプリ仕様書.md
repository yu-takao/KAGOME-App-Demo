# デザインチェックシステム アプリ仕様書

## 目次

1. [システム概要](#システム概要)
2. [画面構成](#画面構成)
3. [機能詳細](#機能詳細)
   - [デザイン検査](#デザイン検査)
   - [検査記録](#検査記録)
   - [設定登録](#設定登録)
4. [UI操作フロー](#ui操作フロー)

---

## システム概要

### 目的
パッケージデザインの自動検査システム。版下データを検査し、デザインガイドラインに準拠しているかを自動的にチェックします。

### 主要機能
- **デザイン検査**: PDFファイルをアップロードし、検査を実行
- **検査記録**: 過去の検査結果を一覧表示・詳細確認
- **設定管理**: 台紙、マーク、テキストルールの登録・編集

---

## 画面構成

### メニュー

以下の3つのメニューがあります：

1. **デザイン検査**
   - 新しい検査を開始する画面

2. **検査記録**
   - 過去の検査結果を一覧表示する画面

3. **設定登録**
   - 台紙、マーク、テキストルールの設定画面

---

## 機能詳細

### デザイン検査

#### 概要
5ステップのウィザード形式で検査を実行します。

#### ステップ構成

1. **データ入力**
2. **入力内容確認**
3. **検査実行**
4. **目視チェック**
5. **結果表示**

#### ステップ1: データ入力

##### 検査対象PDF

**版下PDF（包材制約表示なし）**
- PDFプレビューエリアが表示される
- ドラッグ&ドロップまたはファイル選択でPDFをアップロード
- 選択されたPDFはプレビュー表示される

**台紙PDF**
- PDFプレビューエリアが表示される
- ドラッグ&ドロップまたはファイル選択でPDFをアップロード
- 選択されたPDFはプレビュー表示される

##### 検査設定

**過去の検査から設定**
- セレクトボックスから過去の検査を選択
- 選択すると、製品パッケージ名と印刷会社が自動入力される

**製品パッケージ名**
- テキスト入力フィールド
- 製品パッケージ名を入力

**台紙選択**
- **印刷会社**: セレクトボックスから選択
- **台紙**: 印刷会社を選択すると、該当する台紙一覧が表示される
- セレクトボックスから台紙を選択
- 選択された台紙はPDFプレビューで表示される

#### ステップ2: 入力内容確認

##### 表示内容
- 製品パッケージ名
- 検査対象（版下PDF、台紙PDFのプレビュー）
- 選択台紙（プレビュー）

##### 操作
- ボタンで検査実行ステップへ進む
- ボタンでデータ入力ステップに戻る

#### ステップ3: 検査実行

##### 表示内容
- プログレスバーで検査の進捗を表示
- 検査が完了すると完了メッセージが表示される

#### ステップ4: 目視チェック

##### 表示内容

**チェック項目**
- 版下
- 工場制約
- テキスト
- マーク

**画像表示エリア**
- 検査結果画像が表示される
- 2つのモードが利用可能：
  - **拡大縮小モード**: マウスホイールで拡大縮小、ドラッグで画像を移動
  - **領域選択モード**: 画像上でドラッグしてNG箇所の領域を選択

**NG登録エリア**
- 選択した領域に対するコメントを入力
- ボタンでNG箇所を登録
- 登録されたNG箇所は一覧表示される
- 各NG箇所には削除ボタンが表示される

##### 操作

**モード切替**
- ボタンで画像の拡大縮小・移動モードに切り替え
- ボタンでNG箇所の領域選択モードに切り替え

**拡大縮小モード**
- マウスホイール: 画像を拡大/縮小
- ドラッグ: 画像を移動

**領域選択モード**
- 画像上でドラッグ: NG箇所の領域を選択
- 選択した領域に対してコメントを入力し、ボタンで登録

**NG箇所の管理**
- 登録されたNG箇所は画像上に赤い枠で表示される
- NG箇所をクリックすると選択状態になる
- 選択したNG箇所のコメントを編集可能
- 削除ボタンでNG箇所を削除可能

**完了操作**
- ボタンで確認ダイアログが表示される
- 確認すると結果表示ステップへ進む

#### ステップ5: 結果表示

##### 表示内容

**NG箇所一覧**
- 製品パッケージ名と検査日が表示される
- NG箇所がカード形式で一覧表示される
- 各NG箇所には：
  - 番号
  - サムネイル画像（クリックで拡大表示）
  - 項目名
  - 説明文

**結果画像**
- 検査結果のハイライト画像が表示される
- クリックで拡大表示可能

**検査結果サマリー**
- 4つのカテゴリに分けて結果を表示：
  - **版下**: 版下の種類と寸法、デザイン配置、文字配置、ストロー干渉チェック
  - **工場制約**: 印字範囲、JANコードエリア、工場別制約
  - **テキスト**: 文字サイズチェック（最小サイズ、一括表示、栄養成分表示など）
  - **マーク**: マークのサイズ、色、フチ、クリアスペース、形状チェック
- 各項目は「◯」（合格）または「✕」（不合格）で表示される
- 不合格項目は赤背景で強調表示される

##### 操作
- NG箇所のサムネイルをクリック: 拡大表示（モーダル）
- 結果画像をクリック: 拡大表示（モーダル）
- ボタンで検査記録一覧画面へ遷移
- ボタンで検査結果をエクスポート

**拡大表示モーダル**
- 画像をクリックまたはサムネイルをクリックで表示
- マウスホイールで拡大縮小
- ドラッグで画像を移動
- 閉じるボタンまたは背景をクリックで閉じる

---

### 検査記録

#### 概要
過去の検査結果を一覧表示し、詳細を確認できます。

#### 表示内容

**テーブル形式の一覧**
- **ID**: 検査ID（クリックで展開/折りたたみ）
- **日時**: 検査実行日時
- **パッケージ名**: 製品パッケージ名
- **実行ユーザー**: 検査を実行したユーザー名
- **合否**: 合格/不合格のバッジ表示
- **詳細**: 詳細ボタン

#### 操作

**ソート機能**
- 各列のヘッダーをクリックでソート
- ID、日時、パッケージ名、実行ユーザーでソート可能
- 昇順/降順の切り替え可能

**展開/折りたたみ**
- 同じIDの検査が複数ある場合、IDをクリックで展開/折りたたみ
- 展開すると関連する検査結果が表示される

**詳細表示**
- 詳細ボタンをクリック: 結果詳細画面へ遷移

---

### 設定登録

#### 概要
検査に必要な設定（台紙、マーク、テキストルール）を登録・編集します。

#### タブ構成

1. **台紙登録**
2. **マーク登録**
3. **テキストルール登録**

---

#### 台紙登録

##### 一覧画面

**表示内容**
- テーブル形式で台紙一覧を表示
- **印刷会社**: 台紙を提供する印刷会社名
- **台紙名**: 台紙の名称
- **ストロー**: ストローの有無（あり/なし）
- **操作**: 編集ボタン

**操作**
- 印刷会社、台紙名でソート可能
- ボタンで新規台紙登録画面へ遷移
- 編集ボタンで台紙編集画面へ遷移

##### 新規登録画面

**入力項目**
- **台紙名**: テキスト入力
- **印刷会社**: セレクトボックスまたは新規追加
- **台紙PDF**: ドラッグ&ドロップまたはファイル選択
- **ストロー**: チェックボックス（あり/なし）
- **ストローPDF**: ストローがある場合のみ表示、ドラッグ&ドロップまたはファイル選択

**操作**
- PDFはプレビュー表示される
- ボタンで台紙を登録
- ボタンで一覧画面へ戻る

---

#### マーク登録

##### 一覧画面

**表示内容**
- テーブル形式でマーク一覧を表示
- **マーク名**: マークの名称
- **カテゴリ**: マークのカテゴリ（コーポレート、プロダクトブランド、マーク、活動）
- **プレビュー**: PDFプレビュー
- **操作**: 編集ボタン

**操作**
- マーク名、カテゴリでソート可能
- ボタンで新規マーク登録画面へ遷移
- 編集ボタンでマーク編集画面へ遷移

##### 新規登録画面

**入力項目**
- **マーク名**: テキスト入力
- **カテゴリ**: セレクトボックスから選択
- **マークPDF**: ドラッグ&ドロップまたはファイル選択
- **検出用キーワード**: テキスト入力（複数入力可能）

**操作**
- PDFはプレビュー表示される
- ボタンでマークを登録
- ボタンで一覧画面へ戻る

---

#### テキストルール登録

##### 一覧画面

**表示内容**

**共通ルール**
- 最小サイズ、最大サイズが表示される
- 編集ボタンで共通ルール編集画面へ遷移

**ブロック別ルール**
- テーブル形式でルール一覧を表示
- **ルール名**: ルールの名称
- **最小サイズ**: 最小フォントサイズ（pt）
- **最大サイズ**: 最大フォントサイズ（pt）
- **存在チェック**: 必須かどうか（要/-）
- **自動検出用キーワード**: 検出に使用するキーワード
- **操作**: 編集ボタン

**操作**
- ルール名、最小サイズ、最大サイズ、存在チェック、キーワードでソート可能
- ボタンで新規ルール登録画面へ遷移
- 編集ボタンでルール編集画面へ遷移

##### 共通ルール編集画面

**入力項目**
- **最小サイズ**: テキスト入力（pt）
- **最大サイズ**: テキスト入力（pt）

**操作**
- ボタンで共通ルールを保存
- ボタンで一覧画面へ戻る

##### 新規登録画面

**入力項目**
- **ルール名**: テキスト入力
- **最小サイズ**: テキスト入力（pt）
- **最大サイズ**: テキスト入力（pt）
- **存在チェック**: チェックボックス（必須/任意）
- **自動検出用キーワード**: テキスト入力

**操作**
- ボタンでルールを登録
- ボタンで一覧画面へ戻る

---

## UI操作フロー

### 検査実行フロー

```
1. デザイン検査画面を開く
   ↓
2. データ入力
   - 版下PDFと台紙PDFをアップロード
   - 過去の検査から設定を選択（オプション）
   - 製品パッケージ名を入力
   - 台紙を選択
   ↓
3. 入力内容確認
   - 入力内容を確認
   - ボタンで次へ進む
   ↓
4. 検査実行
   - 自動検査が実行される
   - プログレスバーで進捗を確認
   - ボタンで次へ進む
   ↓
5. 目視チェック
   - 検査結果画像を確認
   - 必要に応じてNG箇所を登録
   - ボタンで完了
   ↓
6. 結果表示
   - 検査結果を確認
   - NG箇所の詳細を確認
   - ボタンで検査記録一覧へ戻る
```

### 設定登録フロー

```
1. 設定登録画面を開く
   ↓
2. タブを選択（台紙/マーク/テキストルール）
   ↓
3. 一覧画面で新規登録ボタンをクリック
   ↓
4. 入力フォームに情報を入力
   ↓
5. ボタンで登録
   ↓
6. 一覧画面に戻り、登録内容が反映される
```

---

## 共通UI機能

### PDFプレビュー

- PDFファイルはプレビュー表示される
- 最大幅・最大高さを指定してアスペクト比を保持したまま表示

### 画像拡大表示

- NG箇所のサムネイルや結果画像をクリックすると拡大表示される
- モーダル形式で表示
- マウスホイールで拡大縮小
- ドラッグで画像を移動
- 閉じるボタンまたは背景をクリックで閉じる

### ソート機能

- テーブルの列ヘッダーをクリックでソート
- 昇順/降順の切り替え可能
- ソート状態は視覚的に表示される

---

## 更新履歴

- 2024年12月: 初版作成
